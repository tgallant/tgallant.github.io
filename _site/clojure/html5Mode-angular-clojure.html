<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>tgallant.github.io</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link href="//fonts.googleapis.com/css?family=Inconsolata:400,300,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/bower_components/pure/pure-min.css">
    <link rel="stylesheet" href="/bower_components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <script src="/bower_components/modernizr/modernizr.js"></script>
    <link rel="stylesheet" href="/bower_components/highlight.js/src/styles/github.css">
    <script src="/bower_components/highlight.js/src/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->












<div class="content">
  <a href="/" class="button-xsmall pure-button">Home</a>
  <a href="/euler/" class="button-xsmall pure-button">Euler</a>
  <a href="/resources/" class="button-xsmall pure-button">Resources</a>

  <div class="header">
    <h2>html5Mode in Angular and Clojure</h2>
    <p><i><a href="https://twitter.com/timgallant">@timgallant</a></i></p>
  </div>
  <ul>
<li>benefits of angularjs html5mode

<ul>
<li>native looking urls</li>
</ul>
</li>
<li>drawbacks of html5mode

<ul>
<li>not sharable</li>
</ul>
</li>
<li>solutions

<ul>
<li>send all traffic to index.hmtl</li>
<li><a href="https://github.com/tgallant/angular-seed-clj">https://github.com/tgallant/angular-seed-clj</a></li>
</ul>
</li>
</ul>


<p>Its probably a purely aesthetic thing, but I'm not a big fan of the
default angularjs urls. I feel having the '#' in there hinders
usability. A project's url structure is more discoverable when it is
familiar to the user. This is where html5Mode can be handy. It will
turn your urls from this</p>

<pre><code>GET /home/#/dashboard
</code></pre>

<p>to this</p>

<pre><code>GET /home/dashboard
</code></pre>

<p>This gets us the url structure we want, but these links are in fact
not sharable. If your application is using html5Mode, the url that
shows up in the browser can't be copy and pasted. Instead of bringing
up the requested page it will throw a 404. This is because the server
is not aware that angular is controlling all of the routes. To get
sharable links with html5Mode the server needs to let angular handle
the application routing.</p>

<p>In nginx this is done by using <code>try_files</code> like so</p>

<pre><code>location / {
  root /path/to/files;
  try_files $uri $uri/ /index.html;
}
</code></pre>

<p>If nginx doesn't get a valid response from the actual url path, it
will send the request to the index.html file, at which point angularjs
will initialize and handle the url parameters. This is a handy trick
that we can actually implement in our server-side code.</p>

<p>In compojure this is done by specifying a wildcard route like so</p>

<pre><code>(defroutes app-routes
  (GET "/" [] (index-page))
  (GET "/api/repo/" [] (api/repo-info))
  (POST "/api/init/" request (api/new-repo (get-in request [:body :name])))
  (GET "*" [] (index-page))
  (route/resources "/")
  (route/not-found "Not Found"))
</code></pre>

<p>In compojure the asterisk stands for the wildcard route. It will match
any route that has not yet been matched. When using wildcards it is
important to put them after all of your defined routes like in the
example above. If a route is defined after the wildcard it will never
be run.</p>

<p>I really like how this clojure/angularjs html5mode setup separates the
concerns of API routes and application routes. Angular takes care of
all browser facing routes while clojure deals with API routes and
database calls. All of this while maintaining our nice clean URI
structure. Hashtags belong on twitter, not in urls!</p>

<p>I've put together a github repo with all of this stuff already setup. Check it
out here <a href="https://github.com/tgallant/angular-seed-clj">https://github.com/tgallant/angular-seed-clj</a>.</p>

</div>

<div id="disqus_thread" class="content"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'schemerocks'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-56332741-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>

